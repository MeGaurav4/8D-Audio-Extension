(()=>{let e,n,o,t,i=!1,a=0,l=1.5,s=.02;function r(){if(i&&o){a+=s,a>2*Math.PI&&(a=0);const n=Math.cos(a)*l,t=Math.sin(a)*l;o.positionX.setValueAtTime(n,e.currentTime),o.positionZ.setValueAtTime(t,e.currentTime)}}chrome.storage.sync.get(["intensity","rotationSpeed"],(function(e){l=e.intensity||1.5,s=e.rotationSpeed||.02})),chrome.runtime.onMessage.addListener((function(c,d,u){return console.log("Message received:",c),"toggle"===c.action?u({enabled:i?(console.log("Disabling 8D Audio"),void(e&&(clearInterval(t),t=null,o&&(o.positionX.setValueAtTime(0,e.currentTime),o.positionZ.setValueAtTime(0,e.currentTime)),i=!1,console.log("8D Audio disabled")))):(console.log("Enabling 8D Audio"),e&&n&&o||function(){if(e)return!0;console.log("Initializing audio nodes");let t=document.querySelector("audio, video");return t?(e=new(window.AudioContext||window.webkitAudioContext),n=e.createMediaElementSource(t),o=e.createPanner(),o.panningModel="HRTF",o.distanceModel="inverse",o.refDistance=1,o.maxDistance=1e4,o.rolloffFactor=1,o.coneInnerAngle=360,o.coneOuterAngle=0,o.coneOuterGain=0,n.connect(o),o.connect(e.destination),console.log("Audio nodes initialized"),!0):(console.error("No audio or video element found on the page"),!1)}()?(e.resume(),i=!0,a=0,t&&clearInterval(t),t=setInterval(r,16),console.log("8D Audio enabled"),!0):(console.error("Failed to initialize audio nodes"),!1))}):"getState"===c.action?u({enabled:i,intensity:l,rotationSpeed:s}):"setIntensity"===c.action?(l=c.value,chrome.storage.sync.set({intensity:c.value})):"getIntensity"===c.action?u({intensity:l}):"setRotationSpeed"===c.action&&(s=c.value,chrome.storage.sync.set({rotationSpeed:c.value})),!0})),console.log("Content script loaded"),logAudioState()})();